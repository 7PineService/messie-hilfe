---
import { SITE_URL, SITE_NAME, CONTACT_EMAIL, CONTACT_PHONE, TWITTER_HANDLE } from '@/config/site';

interface Props {
  title: string;
  description?: string;
  image?: string;
  canonicalUrl?: string;
  noindex?: boolean;
  currentPath: string;
}

const {
  title,
  description = 'Diskrete Messie-Hilfe – zuverlässig, bezahlbar, ohne Bewertung. Professionelle Entrümpelung und Unterstützung bei Messie-Wohnungen.',
  image = '/og-image.jpg',
  canonicalUrl = SITE_URL,
  noindex = false,
  currentPath
} = Astro.props;

const siteName = SITE_NAME;
const twitterHandle = TWITTER_HANDLE;

const generateBreadcrumbs = () => {
  const breadcrumbs = [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Startseite",
      "item": canonicalUrl
    }
  ];

  if (currentPath === '/anfrage/') {
    breadcrumbs.push({
      "@type": "ListItem",
      "position": 2,
      "name": "Kostenloses Angebot anfordern",
      "item": `${canonicalUrl}/anfrage/`
    });
  } else if (currentPath !== '/') {
    breadcrumbs.push({
      "@type": "ListItem",
      "position": 2,
      "name": title,
      "item": canonicalUrl
    });
  }

  return breadcrumbs;
};

const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": siteName,
  "url": canonicalUrl,
  "logo": `${canonicalUrl}/logo.svg`,
  "description": description,
  "contactPoint": {
    "@type": "ContactPoint",
    "telephone": CONTACT_PHONE,
    "contactType": "customer service",
    "email": CONTACT_EMAIL
  },
  "sameAs": [
    `https://twitter.com/${twitterHandle.replace('@', '')}`,
    `https://facebook.com/${siteName.toLowerCase()}`,
    `https://linkedin.com/company/${siteName.toLowerCase()}`
  ]
};

const websiteSchema = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": siteName,
  "url": canonicalUrl,
  "potentialAction": {
    "@type": "SearchAction",
    "target": {
      "@type": "EntryPoint",
      "urlTemplate": `${canonicalUrl}/search?q={search_term_string}`
    },
    "query-input": "required name=search_term_string"
  }
};

const breadcrumbSchema = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": generateBreadcrumbs()
};

const localBusinessSchema = {
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  "name": siteName,
  "image": `${canonicalUrl}${image}`,
  "telephone": CONTACT_PHONE,
  "email": CONTACT_EMAIL,
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "Aindorferstraße 137",
    "addressLocality": "München",
    "postalCode": "80689",
    "addressCountry": "DE"
  },
  "url": canonicalUrl,
  "priceRange": "$$"
};
---

<title>{title}</title>
<meta name="title" content={title} />
<meta name="description" content={description} />
<meta name="keywords" content="Messie-Hilfe, Entrümpelung, Messie-Wohnung, diskrete Hilfe, Wohnungsentrümpelung, Aufräumservice" />
<meta name="author" content={siteName} />
<meta name="robots" content={noindex ? "noindex, nofollow" : "index, follow"} />
<meta name="language" content="German" />
<link rel="canonical" href={canonicalUrl} />

<meta property="og:type" content="website" />
<meta property="og:url" content={canonicalUrl} />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:image" content={`${canonicalUrl}${image}`} />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:site_name" content={siteName} />
<meta property="og:locale" content="de_DE" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:url" content={canonicalUrl} />
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={`${canonicalUrl}${image}`} />
<meta name="twitter:creator" content={twitterHandle} />
<meta name="twitter:site" content={twitterHandle} />

<link rel="icon" type="image/x-icon" href="/favicon.ico" />
<link rel="apple-touch-icon" href="/apple-touch-icon.png" />

<!-- DNS Prefetch for tracking domains -->
<link rel="dns-prefetch" href="https://www.googletagmanager.com" />
<link rel="dns-prefetch" href="https://cdn-cookieyes.com" />
<link rel="dns-prefetch" href="https://www.google-analytics.com" />

{currentPath === '/' && <script type="application/ld+json" set:html={JSON.stringify(organizationSchema)} />}
<script type="application/ld+json" set:html={JSON.stringify(websiteSchema)} />
<script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
<script type="application/ld+json" set:html={JSON.stringify(localBusinessSchema)} />
