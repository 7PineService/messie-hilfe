---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';
import { cn } from '@/utils/cn';

interface Props {
	name: string;
	value: string;
	label: string;
	icon?: ImageMetadata;
	selected?: boolean;
	multiSelect?: boolean;
	disabled?: boolean;
	class?: string;
	[key: string]: any;
}

const {
	name,
	value,
	label,
	icon,
	selected = false,
	multiSelect = true,
	disabled = false,
	class: className = '',
	...rest
} = Astro.props;

const inputType = multiSelect ? 'checkbox' : 'radio';

const baseClasses = 'service-tile relative flex items-center gap-1 rounded-lg cursor-pointer transition border';
const defaultClasses = '';
const selectedClasses = '';
const disabledClasses = 'opacity-50 cursor-not-allowed';
---

<label
	class={cn(
		baseClasses,
		selected ? selectedClasses : defaultClasses,
		disabled && disabledClasses,
		className
	)}
	data-tile-label
	{...rest}
>
	<input
		type={inputType}
		name={multiSelect ? `${name}[]` : name}
		value={value}
		checked={selected}
		disabled={disabled}
		class="sr-only"
		data-tile-input
	/>
	{icon && (
		<Image
			src={icon}
			alt=""
			class="w-16 h-16 object-contain shrink-0"
			loading="eager"
		/>
	)}
	<span class="text-base font-semibold pr-4">{label}</span>
</label>

<style>
	/* State 1: Default/Inactive */
	.service-tile {
		background: var(--color-surface-light-peach);
		border-color: rgba(212, 186, 165, 0.3);
		box-shadow: 0 1px 3px rgba(99, 99, 99, 0.12);
		transition: all 0.15s ease-in-out;
	}

	/* State 2: Hover (not selected) */
	.service-tile:hover:not(:has(input:checked)) {
		background: var(--color-surface-warm-peach);
		border-color: var(--color-border-primary);
		transform: translateY(-1px);
		box-shadow: 0 4px 8px rgba(99, 99, 99, 0.15);
	}

	/* State 3: Selected/Active */
	.service-tile:has(input:checked) {
		background: var(--color-surface-warm-peach);
		border-color: var(--color-cta-primary);
		outline: 2px solid var(--color-cta-primary);
		outline-offset: -1px;
	}

	/* Checkmark indicator for selected state */
	.service-tile:has(input:checked)::after {
		content: '';
		position: absolute;
		top: 6px;
		right: 6px;
		width: 20px;
		height: 20px;
		background: var(--color-cta-primary);
		border-radius: 50%;
		background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='white' stroke-width='3'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M5 13l4 4L19 7'/%3E%3C/svg%3E");
		background-size: 14px;
		background-repeat: no-repeat;
		background-position: center;
	}

	/* State 4: Hover on Selected (deselect hint) */
	.service-tile:has(input:checked):hover {
		opacity: 0.85;
	}

	/* Focus state for accessibility */
	.service-tile:has(input:focus-visible) {
		outline: 2px solid var(--color-border-primary);
		outline-offset: 2px;
	}
</style>
