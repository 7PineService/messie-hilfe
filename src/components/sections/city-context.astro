---
import type { ImageMetadata } from 'astro';
import { Image } from 'astro:assets';

interface Props {
  heading: string;
  text: string;
  image: ImageMetadata;
}

const { heading, text, image } = Astro.props;

const paragraphs = text.split('\n\n').filter((p) => p.trim());
---

<section
  id="city-context-section"
  class="section-bg flex items-center pt-0 py-8 md:py-10 lg:py-12"
>
  <div class="container mx-auto px-4 w-full">
    <div class="max-w-[90%] mx-auto text-center">
      <h2
        class="text-xl md:text-3xl lg:text-3xl xl:text-4xl 2xl:text-5xl min-[1920px]:text-6xl font-bold leading-tight"
      >
        {heading}
      </h2>
    </div>

    <!-- Mobile layout -->
    <div class="md:hidden pt-4">
      <div class="max-w-lg mx-auto px-4">
        {paragraphs[0] && (
          <p class="text-sm opacity-90 leading-relaxed text-justify mb-3" set:html={paragraphs[0]} />
        )}
      </div>

      <Image
        src={image}
        alt={heading}
        class="context-image-mobile"
        widths={[400, 800, 1200]}
        sizes="400px"
        decoding="async"
      />

      <div class="max-w-lg mx-auto px-4">
        {paragraphs[1] && (
          <p class="text-sm opacity-90 leading-relaxed text-justify mt-3" set:html={paragraphs[1]} />
        )}
      </div>
    </div>

    <!-- Desktop layout -->
    <div class="content-bg hidden md:block md:py-8 lg:py-16">
      <div class="mx-auto text-center relative z-10">
        <div class="space-y-3 md:space-y-4 lg:space-y-6 max-w-lg mx-auto px-4">
          {
            paragraphs.map((paragraph) => (
              <p class="text-sm md:text-base lg:text-base xl:text-lg 2xl:text-xl min-[1920px]:text-2xl opacity-90 leading-relaxed text-justify" set:html={paragraph} />
            ))
          }
        </div>
      </div>

      <Image
        src={image}
        alt={heading}
        class="context-image-desktop"
        widths={[400, 800, 1200]}
        sizes="1200px"
        decoding="async"
      />
    </div>
  </div>
</section>

<style>
  .section-bg {
    position: relative;
    color: var(--color-foreground);
  }

  .content-bg {
    position: relative;
  }

  .context-image-mobile {
    display: block;
    width: 100%;
    border-radius: 0.5rem;
  }

  .context-image-desktop {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    margin: 0;
    padding: 0;
    border-radius: 0;
    object-fit: cover;
    z-index: 0;
  }

  @media (min-width: 768px) {
    .content-bg::before {
      content: '';
      position: absolute;
      inset: 0;
      background: var(--color-warm-100);
      opacity: 0.03;
      pointer-events: none;
      z-index: 1;
    }
  }
</style>
