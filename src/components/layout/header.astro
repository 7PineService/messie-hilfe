---
import { CONTACT_EMAIL, CONTACT_PHONE, CONTACT_PHONE_DISPLAY, SITE_NAME } from '@/config/site';
import { Play, Chevron } from '@/components/icons';
---

<header id="main-header" class="z-50 relative border-b-[5px] border-border-primary">
	<div class="bg-surface-muted">
		<div class="container mx-auto px-4 py-2.5">
			<div class="flex flex-wrap items-center justify-between text-sm">
				<a href={`mailto:${CONTACT_EMAIL}`}>
					{CONTACT_EMAIL}
				</a>
				<a href={`tel:${CONTACT_PHONE}`} data-gtm-event="contact_call">
					{CONTACT_PHONE_DISPLAY}
				</a>
			</div>
		</div>
	</div>

	<nav class="bg-surface-secondary" aria-label="Hauptnavigation">
		<div class="container mx-auto px-4">
			<div class="flex items-center justify-between h-18">
				<a href="/" class="flex items-center gap-2" aria-label={`${SITE_NAME} Startseite`}>
					<img src="/logo.svg" alt={`${SITE_NAME} Logo`} class="max-h-14 h-auto w-auto object-contain" />
					<span class="text-xl whitespace-nowrap logo-text">
						<span class="messie">Messie-</span><span class="hilfe">Hilfe</span>
					</span>
				</a>

				<div class="hidden lg:flex items-center gap-8 text-base">
					<a href="/">Startseite</a>
					<div class="relative group/dropdown">
						<a href="/leistungen/" class="flex items-center gap-2">
							Leistungen
							<Chevron size="xs" aria-hidden={true} />
						</a>
						<div class="absolute top-full left-0 pt-2 hidden group-hover/dropdown:block group-focus-within/dropdown:block">
							<div class="w-56 text-base bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden">
								<a href="/messie-reinigung/" class="block px-6 py-3 hover:bg-surface-muted">Messie-Reinigung</a>
								<a href="/entsorgung/" class="block px-6 py-3 hover:bg-surface-muted">Entsorgung</a>
								<a href="/entruempelung/" class="block px-6 py-3 hover:bg-surface-muted">Entrümpelung</a>
								<a href="/desinfektion/" class="block px-6 py-3 hover:bg-surface-muted">Desinfektion</a>
								<a href="/malerarbeiten/" class="block px-6 py-3 hover:bg-surface-muted">Malerarbeiten</a>
								<a href="/renovierung/" class="block px-6 py-3 hover:bg-surface-muted">Renovierung</a>
							</div>
						</div>
					</div>
					<a href="/standorte/">Standorte</a>
					<a href="/ueber-uns/">Über uns</a>
					<a href="/kontakt/">Kontakt</a>
				</div>

				<div class="flex items-center gap-4">
					<a href="/anfrage/" class="cta-secondary hidden md:flex items-center gap-2 text-base border border-cta-border rounded-xl px-4 py-2">
						<span>Kostenloses Angebot anfordern</span>
						<Play size="lg" aria-hidden={true} />
					</a>

					<div class="lg:hidden flex items-center gap-3">
						<button type="button" class="p-2" aria-label="Seite">
							<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
							</svg>
						</button>

						<!-- Animated Hamburger/Close Button -->
						<button
							id="mobile-menu-toggle"
							type="button"
							class="p-2.5 relative w-10 h-10 flex items-center justify-center"
							aria-label="Menü"
							aria-expanded="false"
							aria-controls="mobile-menu"
						>
							<div class="w-6 h-5 relative flex flex-col justify-between">
								<!-- Top line -->
								<span class="hamburger-line block h-0.5 w-full bg-current transform transition-all duration-300 ease-in-out origin-center"></span>
								<!-- Middle line -->
								<span class="hamburger-line block h-0.5 w-full bg-current transition-all duration-300 ease-in-out"></span>
								<!-- Bottom line -->
								<span class="hamburger-line block h-0.5 w-full bg-current transform transition-all duration-300 ease-in-out origin-center"></span>
							</div>
						</button>
					</div>
				</div>
			</div>
		</div>

		<!-- Mobile Menu Panel (slides from right to left below header) -->
		<div id="mobile-menu" class="lg:hidden fixed left-0 right-0 w-full bg-white shadow-lg transform translate-x-full transition-transform duration-300 ease-in-out overflow-y-auto" style="top: var(--header-height, 120px); height: calc(100vh - var(--header-height, 120px)); z-index: 30;" aria-label="Hauptnavigation" aria-hidden="true">
			<!-- Menu Content -->
			<nav class="py-2">
				<a href="/" class="block px-6 py-3.5 text-base font-medium hover:bg-gray-50 transition-colors">Startseite</a>

				<!-- Services Dropdown -->
				<div class="border-y border-gray-100 my-1">
					<button
						id="services-toggle-btn"
						class="w-full px-6 py-3.5 text-base font-medium flex items-center justify-between hover:bg-gray-50 transition-colors"
						aria-expanded="false"
						aria-controls="mobile-services-menu"
					>
						<span>Leistungen</span>
						<Chevron size="sm" class="transform transition-transform duration-200" aria-hidden={true} />
					</button>
					<div id="mobile-services-menu" class="overflow-hidden transition-all duration-300 max-h-0">
						<div class="bg-gray-50 py-1">
							<a href="/messie-reinigung/" class="block px-6 py-3 pl-12 text-sm hover:bg-gray-100 transition-colors">Messie-Reinigung</a>
							<a href="/entsorgung/" class="block px-6 py-3 pl-12 text-sm hover:bg-gray-100 transition-colors">Entsorgung</a>
							<a href="/entruempelung/" class="block px-6 py-3 pl-12 text-sm hover:bg-gray-100 transition-colors">Entrümpelung</a>
							<a href="/desinfektion/" class="block px-6 py-3 pl-12 text-sm hover:bg-gray-100 transition-colors">Desinfektion</a>
							<a href="/malerarbeiten/" class="block px-6 py-3 pl-12 text-sm hover:bg-gray-100 transition-colors">Malerarbeiten</a>
							<a href="/renovierung/" class="block px-6 py-3 pl-12 text-sm hover:bg-gray-100 transition-colors">Renovierung</a>
						</div>
					</div>
				</div>

				<a href="/standorte/" class="block px-6 py-3.5 text-base font-medium hover:bg-gray-50 transition-colors">Standorte</a>
				<a href="/ueber-uns/" class="block px-6 py-3.5 text-base font-medium hover:bg-gray-50 transition-colors">Über uns</a>
				<a href="/kontakt/" class="block px-6 py-3.5 text-base font-medium hover:bg-gray-50 transition-colors">Kontakt</a>
			</nav>

			<!-- CTA Button in Menu -->
			<div class="px-5 py-6 border-t border-gray-200">
				<a href="/anfrage/" class="cta-secondary w-full inline-flex items-center justify-center gap-2 text-base font-medium border border-cta-border rounded-xl px-4 py-3">
					<span>Kostenloses Angebot anfordern</span>
					<Play size="lg" aria-hidden={true} />
				</a>
			</div>
		</div>
	</nav>
</header>

<style>
	.messie {
		font-weight: 600;
		color: var(--color-logo-messie);
	}

	.hilfe {
		font-weight: 400;
		color: #8B7A6A;
	}

	#mobile-menu-toggle[aria-expanded="true"] .hamburger-line:nth-child(1) {
		transform: translateY(9px) rotate(45deg);
	}

	#mobile-menu-toggle[aria-expanded="true"] .hamburger-line:nth-child(2) {
		opacity: 0;
	}

	#mobile-menu-toggle[aria-expanded="true"] .hamburger-line:nth-child(3) {
		transform: translateY(-9px) rotate(-45deg);
	}
</style>

<script>
	document.addEventListener('DOMContentLoaded', () => {
		const header = document.getElementById('main-header');
		const mobileMenu = document.getElementById('mobile-menu');
		const menuToggleBtn = document.getElementById('mobile-menu-toggle');
		const servicesToggle = document.getElementById('services-toggle-btn');
		const servicesMenu = document.getElementById('mobile-services-menu');

		// Calculate and set header height for mobile menu positioning
		const updateMenuPosition = () => {
			if (header) {
				const headerHeight = header.offsetHeight;
				document.documentElement.style.setProperty('--header-height', `${headerHeight}px`);
			}
		};

		updateMenuPosition();
		window.addEventListener('resize', updateMenuPosition);

		// Sticky header on scroll
		const handleScroll = () => {
			const scrollTop = window.scrollY || document.documentElement.scrollTop;

			if (scrollTop > 0) {
				if (!header?.classList.contains('sticky')) {
					header?.classList.add('sticky', 'top-0');
				}
			} else {
				header?.classList.remove('sticky', 'top-0');
			}
		};

		window.addEventListener('scroll', handleScroll, { passive: true });

		// Mobile menu toggle with animations
		const toggleMobileMenu = () => {
			const isExpanded = menuToggleBtn?.getAttribute('aria-expanded') === 'true';

			if (isExpanded) {
				// Close menu
				mobileMenu?.classList.add('translate-x-full');
				mobileMenu?.setAttribute('aria-hidden', 'true');
				menuToggleBtn?.setAttribute('aria-expanded', 'false');
				menuToggleBtn?.setAttribute('aria-label', 'Menü');
				document.body.style.overflow = '';
			} else {
				// Open menu
				updateMenuPosition(); // Ensure position is correct
				mobileMenu?.classList.remove('translate-x-full');
				mobileMenu?.setAttribute('aria-hidden', 'false');
				menuToggleBtn?.setAttribute('aria-expanded', 'true');
				menuToggleBtn?.setAttribute('aria-label', 'Menü schließen');
				document.body.style.overflow = 'hidden';
			}
		};

		menuToggleBtn?.addEventListener('click', toggleMobileMenu);

		// Services submenu toggle with animation
		servicesToggle?.addEventListener('click', () => {
			const isExpanded = servicesToggle.getAttribute('aria-expanded') === 'true';
			const chevron = servicesToggle.querySelector('svg');

			if (isExpanded) {
				// Collapse
				servicesToggle.setAttribute('aria-expanded', 'false');
				servicesMenu?.style.setProperty('max-height', '0px');
				chevron?.classList.remove('rotate-180');
			} else {
				// Expand
				servicesToggle.setAttribute('aria-expanded', 'true');
				const scrollHeight = servicesMenu?.scrollHeight || 0;
				servicesMenu?.style.setProperty('max-height', `${scrollHeight}px`);
				chevron?.classList.add('rotate-180');
			}
		});
	});
</script>
